@echo off
chcp 65001 > nul
echo ====================================================
echo Проверка и запуск процесса установки...
echo ====================================================

echo [1/5] Проверка версии Python...
python -c "import sys; print('OK') if sys.version_info >= (3, 11) else sys.exit(1)" > nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo ОШИБКА: Требуется Python версии 3.11 или выше.
    echo Текущая версия:
    python --version
    goto :error
)

echo [2/5] Проверка виртуального окружения...
if exist ".venv" (
    echo Виртуальное окружение уже существует, пропускаем создание.
) else (
    echo Создание виртуального окружения...
    python -m venv .venv || (
        echo ОШИБКА: Не удалось создать виртуальное окружение.
        goto :error
    )
)


echo [3/5] Активация виртуального окружения...
call .venv\Scripts\activate.bat || (
    echo ОШИБКА: Не удалось активировать виртуальное окружение.
    goto :error
)

echo [4/5] Обновление pip...
python -m pip install --upgrade pip || (
    echo ОШИБКА: Не удалось обновить pip.
    goto :error
)

echo [5/5] Установка зависимостей из requirements.txt...
pip install -r requirements.txt || (
    echo ОШИБКА: Не удалось установить зависимости.
    goto :error
)

echo ====================================================
echo Установка успешно завершена!
echo Виртуальное окружение создано и настроено.
echo Все зависимости установлены.
echo ====================================================
pause
exit /b 0

:error
echo ====================================================
echo Произошла ошибка во время установки.
echo Пожалуйста, проверьте сообщения выше.
echo ====================================================
pause
exit /b 1